{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\wisdo\\\\Documents\\\\GitHub\\\\Final year project\\\\food-web-app\\\\Project\\\\frontend\\\\src\\\\context\\\\ChatContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n/**\r\n * Chat Context\r\n *\r\n * Manages chat state for the Diet Advisor conversation\r\n */\n\nimport React, { createContext, useContext, useState, useCallback } from 'react';\nimport { sendChatMessage, getConversations, getConversation } from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatContext = /*#__PURE__*/createContext(null);\nexport const useChat = () => {\n  _s();\n  const context = useContext(ChatContext);\n  if (!context) {\n    throw new Error('useChat must be used within a ChatProvider');\n  }\n  return context;\n};\n_s(useChat, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const ChatProvider = ({\n  children\n}) => {\n  _s2();\n  const [conversations, setConversations] = useState([]);\n  const [currentConversation, setCurrentConversation] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [isTyping, setIsTyping] = useState(false);\n  const [error, setError] = useState(null);\n\n  // Load conversation list\n  const loadConversations = useCallback(async () => {\n    try {\n      const response = await getConversations();\n      if (response.success) {\n        setConversations(response.conversations);\n      }\n    } catch (err) {\n      console.error('Failed to load conversations:', err);\n    }\n  }, []);\n\n  // Load a specific conversation\n  const loadConversation = useCallback(async conversationId => {\n    try {\n      const response = await getConversation(conversationId);\n      if (response.success) {\n        setCurrentConversation(response.conversation);\n        setMessages(response.conversation.messages || []);\n      }\n    } catch (err) {\n      console.error('Failed to load conversation:', err);\n      setError('Failed to load conversation');\n    }\n  }, []);\n\n  // Start a new conversation\n  const startNewConversation = useCallback(() => {\n    setCurrentConversation(null);\n    setMessages([]);\n    setError(null);\n  }, []);\n\n  // Send a message\n  const sendMessage = useCallback(async messageText => {\n    if (!messageText.trim()) return;\n    setError(null);\n\n    // Add user message to UI immediately\n    const userMessage = {\n      id: Date.now(),\n      role: 'user',\n      content: messageText,\n      created_at: new Date().toISOString()\n    };\n    setMessages(prev => [...prev, userMessage]);\n\n    // Show typing indicator\n    setIsTyping(true);\n    try {\n      const response = await sendChatMessage(messageText, currentConversation === null || currentConversation === void 0 ? void 0 : currentConversation.id);\n      if (response.success) {\n        // Add assistant response\n        const assistantMessage = {\n          id: Date.now() + 1,\n          role: 'assistant',\n          content: response.response,\n          created_at: new Date().toISOString()\n        };\n        setMessages(prev => [...prev, assistantMessage]);\n\n        // Update current conversation ID if new\n        if (!currentConversation && response.conversation_id) {\n          setCurrentConversation({\n            id: response.conversation_id\n          });\n          // Refresh conversation list\n          loadConversations();\n        }\n      } else {\n        setError(response.error || 'Failed to send message');\n      }\n    } catch (err) {\n      console.error('Failed to send message:', err);\n      setError('Failed to send message. Please try again.');\n    } finally {\n      setIsTyping(false);\n    }\n  }, [currentConversation, loadConversations]);\n\n  // Delete a conversation\n  const deleteConversation = useCallback(async conversationId => {\n    try {\n      const api = (await import('../services/api')).default;\n      await api.delete(`/conversations/${conversationId}`);\n\n      // Remove from list\n      setConversations(prev => prev.filter(c => c.id !== conversationId));\n\n      // Clear if it was the current conversation\n      if ((currentConversation === null || currentConversation === void 0 ? void 0 : currentConversation.id) === conversationId) {\n        startNewConversation();\n      }\n    } catch (err) {\n      console.error('Failed to delete conversation:', err);\n    }\n  }, [currentConversation, startNewConversation]);\n  const value = {\n    conversations,\n    currentConversation,\n    messages,\n    isTyping,\n    error,\n    loadConversations,\n    loadConversation,\n    startNewConversation,\n    sendMessage,\n    deleteConversation\n  };\n  return /*#__PURE__*/_jsxDEV(ChatContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 145,\n    columnNumber: 5\n  }, this);\n};\n_s2(ChatProvider, \"n1dCtTZaNYKeUO0P61T4MdFKCMc=\");\n_c = ChatProvider;\nexport default ChatContext;\nvar _c;\n$RefreshReg$(_c, \"ChatProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useCallback","sendChatMessage","getConversations","getConversation","jsxDEV","_jsxDEV","ChatContext","useChat","_s","context","Error","ChatProvider","children","_s2","conversations","setConversations","currentConversation","setCurrentConversation","messages","setMessages","isTyping","setIsTyping","error","setError","loadConversations","response","success","err","console","loadConversation","conversationId","conversation","startNewConversation","sendMessage","messageText","trim","userMessage","id","Date","now","role","content","created_at","toISOString","prev","assistantMessage","conversation_id","deleteConversation","api","default","delete","filter","c","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/wisdo/Documents/GitHub/Final year project/food-web-app/Project/frontend/src/context/ChatContext.js"],"sourcesContent":["/**\r\n * Chat Context\r\n *\r\n * Manages chat state for the Diet Advisor conversation\r\n */\r\n\r\nimport React, { createContext, useContext, useState, useCallback } from 'react';\r\nimport { sendChatMessage, getConversations, getConversation } from '../services/api';\r\n\r\nconst ChatContext = createContext(null);\r\n\r\nexport const useChat = () => {\r\n  const context = useContext(ChatContext);\r\n  if (!context) {\r\n    throw new Error('useChat must be used within a ChatProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const ChatProvider = ({ children }) => {\r\n  const [conversations, setConversations] = useState([]);\r\n  const [currentConversation, setCurrentConversation] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Load conversation list\r\n  const loadConversations = useCallback(async () => {\r\n    try {\r\n      const response = await getConversations();\r\n      if (response.success) {\r\n        setConversations(response.conversations);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to load conversations:', err);\r\n    }\r\n  }, []);\r\n\r\n  // Load a specific conversation\r\n  const loadConversation = useCallback(async (conversationId) => {\r\n    try {\r\n      const response = await getConversation(conversationId);\r\n      if (response.success) {\r\n        setCurrentConversation(response.conversation);\r\n        setMessages(response.conversation.messages || []);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to load conversation:', err);\r\n      setError('Failed to load conversation');\r\n    }\r\n  }, []);\r\n\r\n  // Start a new conversation\r\n  const startNewConversation = useCallback(() => {\r\n    setCurrentConversation(null);\r\n    setMessages([]);\r\n    setError(null);\r\n  }, []);\r\n\r\n  // Send a message\r\n  const sendMessage = useCallback(async (messageText) => {\r\n    if (!messageText.trim()) return;\r\n\r\n    setError(null);\r\n\r\n    // Add user message to UI immediately\r\n    const userMessage = {\r\n      id: Date.now(),\r\n      role: 'user',\r\n      content: messageText,\r\n      created_at: new Date().toISOString()\r\n    };\r\n    setMessages(prev => [...prev, userMessage]);\r\n\r\n    // Show typing indicator\r\n    setIsTyping(true);\r\n\r\n    try {\r\n      const response = await sendChatMessage(\r\n        messageText,\r\n        currentConversation?.id\r\n      );\r\n\r\n      if (response.success) {\r\n        // Add assistant response\r\n        const assistantMessage = {\r\n          id: Date.now() + 1,\r\n          role: 'assistant',\r\n          content: response.response,\r\n          created_at: new Date().toISOString()\r\n        };\r\n        setMessages(prev => [...prev, assistantMessage]);\r\n\r\n        // Update current conversation ID if new\r\n        if (!currentConversation && response.conversation_id) {\r\n          setCurrentConversation({ id: response.conversation_id });\r\n          // Refresh conversation list\r\n          loadConversations();\r\n        }\r\n      } else {\r\n        setError(response.error || 'Failed to send message');\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to send message:', err);\r\n      setError('Failed to send message. Please try again.');\r\n    } finally {\r\n      setIsTyping(false);\r\n    }\r\n  }, [currentConversation, loadConversations]);\r\n\r\n  // Delete a conversation\r\n  const deleteConversation = useCallback(async (conversationId) => {\r\n    try {\r\n      const api = (await import('../services/api')).default;\r\n      await api.delete(`/conversations/${conversationId}`);\r\n\r\n      // Remove from list\r\n      setConversations(prev =>\r\n        prev.filter(c => c.id !== conversationId)\r\n      );\r\n\r\n      // Clear if it was the current conversation\r\n      if (currentConversation?.id === conversationId) {\r\n        startNewConversation();\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to delete conversation:', err);\r\n    }\r\n  }, [currentConversation, startNewConversation]);\r\n\r\n  const value = {\r\n    conversations,\r\n    currentConversation,\r\n    messages,\r\n    isTyping,\r\n    error,\r\n    loadConversations,\r\n    loadConversation,\r\n    startNewConversation,\r\n    sendMessage,\r\n    deleteConversation\r\n  };\r\n\r\n  return (\r\n    <ChatContext.Provider value={value}>\r\n      {children}\r\n    </ChatContext.Provider>\r\n  );\r\n};\r\n\r\nexport default ChatContext;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}